<!DOCTPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>D3 Test</title>
    <script type="text/javascript" src="d3/d3.js"></script>
    <link rel="stylesheet" href="site.css">
    <link rel="stylesheet" href="bootstrap/css/bootstrap.css">
</head>
<body>
    <div class="row">
        <div class="col-md-6">
            <h1>Misc</h1>
            <div id="rects"></div>
        </div>
        <div class="col-md-6">
            <h1>Presidents</h1>
            <div id="presBars"></div>
        </div>
    </div>
    <br />
    <div class="row">
        <div class="col-md-6">
            <div id="scatter"></div>
        </div>
        <div class="col-md-6">
            <div id="presJitter"></div>
        </div>
    </div>
    <br />
    <div class="row">
            <div class="col-md-6">
                <div id="tobefilled"></div>
            </div>
            <div class="col-md-6">
                <div id="presHist"></div>
            </div>
        </div>

    <script type="text/javascript">
        var w = 600;
        var h = 120;
        var barPadding = 1;
        var firstX = w/3;
        // Coordinate and color-values for five rectangle objects.
        var squareCoordinates = [{x:firstX, y:0, color:"rgba(128, 0, 128, 1.0)"}, 
                                {x:firstX*1.125, y:5, color:"rgba(0, 0, 255, 0.75)"},
                                {x:firstX*1.25, y:10, color:"rgba(0, 255, 0, 0.5)"}, 
                                {x:firstX*1.375, y:15, color:"rgba(255, 255, 0, 0.25)"},
                                {x:firstX*1.5, y:20, color:"rgba(255, 0, 0, 0.1)"}];

        var svg = d3.select("#rects")
                    .append("svg")
                    .attr("width", w)
                    .attr("height", h);
        
        svg.selectAll("rect")
            .data(squareCoordinates)
            .enter()
            .append("rect")
            .attr("x", function(d) {
                return d.x;
            })
            .attr("y", function(d) {
                return d.y;
            })
            .attr("width", h*0.5)
            .attr("height", h*0.5)
            .attr("fill", function(d) {
                return d.color;
            });

        d3.csv("data2d.csv", function(data) {
            var padding = 20;
            var xScale = d3.scaleLinear()
                            .domain([0, d3.max(data, function(d) { return parseInt(d.x); })])
                            .range([padding, w - padding]);
                
            var yScale = d3.scaleLinear()
                            .domain([0, d3.max(data, function(d) { return parseInt(d.y); })])
                            .range([h, padding]);
                
            var rScale = d3.scaleLinear()
                            .domain([0, d3.max(data, function(d) { return d.y; })])
                            .range([2,6]);

            // New SVG-element added for scatter-plot
            var svg = d3.select("#scatter")
                        .append("svg")
                        .attr("width", w)
                        .attr("height", h);

            svg.selectAll("circle")
                .data(data)
                .enter()
                .append("circle")
                .attr("cx", function(d) {
                    return xScale(d.x);
                })
                .attr("cy", function(d) {
                    return yScale(d.y);
                })
                .attr("r", function(d) {
                    return rScale(d.y);
                });
                
            // Text elements added to label the data points
            svg.selectAll("text")
                .data(data)
                .enter()
                .append("text")
                .text(function(d) {
                    return d.x + "," + d.y;
                })
                .attr("x", function(d) {
                    return xScale(d.x)
                })
                .attr("y", function(d) {
                    return yScale(d.y);
                })
                .attr("font-size", "11px")
                .attr("fill", "red");
                
            var xAxis = d3.axisBottom(xScale);
            svg.append("g")
                .attr("class", "axis")
                .attr("transform", "translate(0," + (h - padding) + ")")
                .call(xAxis);
                
            var yAxis = d3.axisLeft(yScale).ticks(4);
            svg.append("g")
                .attr("class", "axis")
                .attr("transform", "translate(" + padding + ",0)")
                .call(yAxis);
            
            d3.select("body").append("br");

            d3.csv("pres.csv", function(data) {
                drawBarChartWithPresData(data,w,h, barPadding, "#presBars");
                drawJitterPlotWithPresData(data,w,h, padding, "#presJitter");
                drawHistogramWithPresData(data,w,h,padding,"#presHist");
            });
        });

        var drawHistogramWithPresData = function(data,w,h,padding,id) {
            var numberOfBins = 8;
            var xScale = d3.scaleLinear()
                            .domain([0, d3.max(data, function(d) { return parseInt(d.days); })])
                            .range([padding, w - padding]);
            
            var bins = generateHistogramBins(data, numberOfBins);

            var yScale = d3.scaleLinear()
                            .domain([0, d3.max(bins, function(b) { return b.count; })])
                            .range([h, padding]);

            // New SVG-element added for histogram
            var svg = d3.select(id)
                        .append("svg")
                        .attr("width", w)
                        .attr("height", h);
            
            svg.selectAll("rect")
                .data(bins)
                .enter()
                .append("rect")
                .attr("x", function(b) { return xScale(b.x0) + 1; })
                .attr("y", function(b) { return yScale(b.count) - padding; })
                .attr("width", function(b) {
                    return xScale(b.x1) - xScale(b.x0) - 2;
                })
                .attr("height", function(b) {
                    return h - yScale(b.count);
                })
                .attr("fill","teal");

            var tickValues = []
            for (var i = 0; i < bins.length; i++) {Â tickValues.push(bins[i].x0); }

            var xAxis = d3.axisBottom(xScale).tickValues(tickValues);
            svg.append("g")
                .attr("class", "axis")
                .attr("transform", "translate(0," + (h - padding) + ")")
                .call(xAxis);
            
            var yAxis = d3.axisLeft(yScale).ticks(5);
            svg.append("g")
                .attr("class", "axis")
                .attr("transform", "translate(" + padding + ", -" + padding + ")")
                .call(yAxis);
        }

        var generateHistogramBins = function(data,ticks) {
            var max = d3.max(data, function(d) { return parseInt(d.days); });
            var binWidth = max/ticks;
            var bins = [{ x0: 0, x1:binWidth, count:0}];
            for (var i = 1; i < ticks; i++) {
                var x0 = bins[i-1].x1;
                bins.push({ x0: x0, x1: x0+binWidth, count:0}) 
            }

            for (var i = 0; i < data.length; i++) {
                var binIndex = Math.floor((data[i].days / max) * ticks);
                if (binIndex == ticks) {
                    binIndex--;
                }
                
                bins[binIndex].count += 1;
            }
            
            return bins;
        }

        var drawJitterPlotWithPresData = function(data,w,h,padding,id) {
            var xScale = d3.scaleLinear()
                            .domain([0, d3.max(data, function(d) { return parseInt(d.days); })])
                            .range([padding, w - padding]);
            
            // New SVG-element added for jitter-plot
            var svg = d3.select(id)
                        .append("svg")
                        .attr("width", w)
                        .attr("height", h);

            svg.selectAll("circle")
                .data(data)
                .enter()
                .append("circle")
                .attr("cx", function(d) {
                    return xScale(d.days) + getJitter();
                })
                .attr("cy", function(d) {
                    return (h / 2) + getJitter();
                })
                .attr("r", 5)
                .attr("stroke", "black")
                .attr("fill", "white");
            
            var xAxis = d3.axisBottom(xScale);
            svg.append("g")
                .attr("class", "axis")
                .attr("transform", "translate(0," + (h - padding) + ")")
                .call(xAxis);
        }

        var getJitter = function() {
            var random = Math.random();
            return [-5, 5][Math.floor(2*random)]*random;
        }

        var drawBarChartWithPresData = function(data,w,h,barPadding,id) {
            var height = h*1.5;
            var svg = d3.select(id)
                .append("svg")
                .attr("width", w)
                .attr("height", height);
        
            svg.selectAll("rect")
                .data(data)
                .enter()
                .append("rect")
                .attr("x", function(d, i) {
                    return i * (w / data.length);
                })
                .attr("y", function(d) {
                    return h - d.days*2;
                })
                .attr("width", w / data.length - barPadding)
                .attr("height", function(d) {
                    return d.days*2;
                })
                .attr("fill","teal");

            svg.selectAll("text")
                .data(data)
                .enter()
                .append("text")
                .text(function(d) {
                    return d.pres;
                })
                .attr("x", function(d,i) {
                    return h*1.05;
                })
                .attr("y", function(d,i) {                    
                    return i * (-1) * (w / data.length);
                })
                .attr("fill", "black")
                .attr("transform", "rotate(90)")
                .attr("font-size", "10px")
                .attr("text-anchor", "center");
        }
    </script>
</body>
</html>